{% if account != nil and user.superuser %}

  {% assign document = nil | new_hash %}

  {% assign field_names = "mail_address phone admin_url admin_username admin_password comments ftp_host ftp_username ftp_password ssh_address ssh_password" %}

  {% for field_name in field_names %}

    {% if params[field_name] != nil and params[field_name] != "" %}

      {% assign document = document | push_to_hash: field_name, params[field_name] %}

    {% endif %}

  {% endfor %}

  {% assign ticket_insertion  = "create_ticket" | db_insert_one: document: document %}

  {% if ticket_insertion.created_count == 1 %}

    Turbolinks.visit("{{ 'tickets__show' | path_for: id: ticket_insertion._id }}");

  {% endif %}
{% endif %}