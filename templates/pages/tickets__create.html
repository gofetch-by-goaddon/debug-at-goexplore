{% if account != nil and user.superuser %}

  {% assign document  = nil | new_hash %}
  {% assign document  = document | push_to_hash: "status", "opened" %}
  {% assign token     = nil | new_uuid %}
  {% assign document  = document | push_to_hash: "token", token %}
  {% assign log       = "" | split: " " %}
  {% assign document  = document | push_to_hash: "log", log %}
  {% assign now       = "now" | in_time_zone %}
  {% assign document  = document | push_to_hash: "opened_at", now %}

  {% assign field_names = "webshop_id auth_id relay_id mail_address phone admin_url admin_username admin_password comments ftp_host ftp_username ftp_password ssh_address ssh_password" %}

  {% for field_name in field_names %}
    {% if params[field_name] != nil and params[field_name] != "" %}

      {% assign document = document | push_to_hash: field_name, params[field_name] %}

    {% endif %}
  {% endfor %}

  {% assign ticket_insertion  = "create_ticket" | db_insert_one: document: document %}
  console.log({{ ticket_insertion | json }});
  {% if ticket_insertion.created_count == 1 %}

    Turbolinks.visit("{{ 'tickets__show' | path_for: id: ticket_insertion._id }}");

  {% endif %}
{% endif %}