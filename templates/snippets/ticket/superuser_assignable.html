{% assign assignable = false %}

{% if superuser._id != user._id and superuser._id != ticket.superuser_id %}
  {% if superuser.superuser_level == 1 %}

    {% assign assignable = true %}

  {% else %}

    {% if superuser.closed_ticket_relay_ids != nil and superuser.closed_ticket_relay_ids.size > 0 %}

      {% assign permitted_relay_ids = superuser.closed_ticket_relay_ids %}

    {% elsif superuser.ticket_relay_ids != nil and superuser.ticket_relay_ids.size > 0 %}

      {% assign permitted_relay_ids = superuser.ticket_relay_ids %}

    {% endif %}

    {% if permitted_relay_ids != nil and permitted_relay_ids contains ticket.relay_id %}

      {% assign assignable = true %}

    {% endif %}
  {% endif %}
{% endif %}