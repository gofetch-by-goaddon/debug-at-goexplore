{% if error != nil %}
  <h5 class="mb-3">
    {{ l.headlines.error }} <a href="{{ 'tickets__index' | path_for }}">{{ l.headlines.return }}<i class="fas fa-undo"></i></a>
  </h5>
  <p>{{ error }}</p>
{% else %}

  {% include "shared/indent_json_pre" %}

  <h5 class="mb-3">
    {{ l.headlines.intro }} <a href="{{ 'tickets__index' | path_for }}">{{ l.headlines.return }} <i class="fas fa-undo"></i></a>
  </h5>

  <table class="table">
    <tbody>
      {% assign now                 = "now" | date: "%Y-%m-%d %H:%M:%S" | parse_time %}
      {% assign status_field_names  = "opened_at in_progress_at closed_at escalated_at" | split: " " %}
      {% assign input_field_names   = "mail_address phone comments admin_url admin_username admin_password ftp_host ftp_username ftp_password ssh_address ssh_password" | split: " " %}
      {% assign field_names  = status_field_names | concat: input_field_names %}

      {% if relay != nil %}
        <tr>
          <td width="1" class="text-nowrap">
            <b>{{ l.headers.relay }}:</b>
          </td>
          <td>
            {{ relay.name }}
          </td>
        </tr>
      {% endif %}

      {% if ticket.webshop_id != nil %}
        <tr>
          <td width="1" class="text-nowrap">
            <b>{{ l.headers.webshop }}:</b>
          </td>
          <td>
            <a href="{{ 'webshops__edit' | path_for: id: ticket.webshop_id }}" target="_blank">{{ l.informations.edit_webshop }} <i class="fas fa-external-link-alt"></i></a> {{ l.informations.or }} <a href="{{ 'webshops__show' | path_for: id: ticket.webshop_id }}" target="_blank">{{ l.informations.show_webshop }} <i class="fas fa-external-link-alt"></i></a>
          </td>
        </tr>
      {% endif %}

      <tr>
        <td width="1" class="text-nowrap">
          <b>{{ l.headers.options }}:</b>
        </td>
        <td>
          {% assign statuses = "in_progress closed escalated" | split: " " %}
          {% for status in statuses %}
            {% if ticket.status != status %}
              <form action="{{ 'tickets__update' | path_for: id: ticket._id, format: 'js' }}" method="patch" data-remote="true">
                {{ l.update_status.intros[statuses] }}<input type="hidden" name="status" value="{{ status }}"><input type="submit" class="submit-link d-inline border-0 py-0 pr-0 text-primary" value="{{ l.update_status.links[status] }}">
              </form>
            {% endif %}
          {% endfor %}
        </td>
      </tr>

      {% for field_name in field_names %}
        {% if ticket[field_name] != nil and ticket[field_name] != "" %}
          <tr>
            <td width="1" class="text-nowrap">
              <b>{{ l.headers[field_name] }}:</b>
            </td>
            <td>
              {% if status_field_names contains field_name %}
                <span title="{{ ticket[field_name] | i18n_l: 'wday_date_hours_minutes' | capitalize }}">
                  {{ ticket[field_name] | time_distance_in_words: now }} {{ l.informations.ago }}
                </span>
              {% else %}
                {{ ticket[field_name] | decrypt }}
              {% endif %}
            </td>
          </tr>
        {% endif %}
      {% endfor %}
    </tbody>
  </table>

  {% if auth != nil %}
    {% assign auth_field_names = "webshop_config setup_config error log" | split: " " %}

    {% for auth_field_name in auth_field_names %}
      {% if auth[auth_field_name] != nil %}
        <p class="mt-4">
          <b>{{ l.auth_headlines[auth_field_name] }}</b>
        </p>
        <p>{{ l.auth_explainers[auth_field_name] }}:</p>

        {% if auth_field_name == "error" %}

          {% assign auth_error = "" | split: " " %}

          {% for auth_e in auth.error %}

            {% assign encrypted_hash = auth_e %}
            {% include "shared/decrypt_hash" %}

            {% assign auth_error = auth_error | push_to_array: decrypted_hash %}

          {% endfor %}

          {% assign decrypted_hash = auth_error %}

        {% else %}

          {% assign encrypted_hash = auth[auth_field_name] %}
          {% include "shared/decrypt_hash" %}

        {% endif %}

        <div class="json-pre-container">
          <div class="json-sample" style="display: none;">{{ decrypted_hash | json }}</div>
          <pre class="language-json"><code class="language-json"></code></pre>
        </div>
      {% endif %}
    {% endfor %}
  {% endif %}
{% endif %}